/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * To learn more about Gradle by exploring our Samples at https://docs.gradle.org/8.2.1/samples
 */
buildscript {
  configurations {
    all {
      exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
  }
}

plugins {
  id 'com.github.spotbugs' version '5.1.4' apply false
}

subprojects {
  apply plugin: 'java'
  apply plugin: 'jacoco'
  apply plugin: 'checkstyle'
  apply plugin: 'com.github.spotbugs'

  compileJava.options.encoding = 'UTF-8'
  compileTestJava.options.encoding = 'UTF-8'
  javadoc.options.encoding = 'UTF-8'
  
  dependencies {
    implementation 'org.apache.commons:commons-lang3:3.13.0'
    implementation 'org.springframework.boot:spring-boot-starter-validation'
  
    // Lombokの設定
    // annotationProcessorの設定を加えないとcompileJavaでエラーが発生する
    annotationProcessor 'org.projectlombok:lombok'
    testAnnotationProcessor 'org.projectlombok:lombok'
    compileOnly 'org.projectlombok:lombok'
    testCompileOnly 'org.projectlombok:lombok'

    // SpotBugsの警告対策
    // https://github.com/spotbugs/spotbugs-gradle-plugin/issues/136
    spotbugsSlf4j  "org.slf4j:slf4j-simple"
  }

  jacoco {
    toolVersion = '0.8.10'
  }
  checkstyle {
    toolVersion = '10.12.2'
    configDirectory = rootProject.file('config/checkstyle')
  } 
  spotbugs {
    toolVersion = '4.7.3'
    ignoreFailures = true
  }

  // testタスクの後にjacocoTestReportタスクを実施する
  test {
    // UTテスト時はtestプロファイルを利用
    jvmArgs=['-Dspring.profiles.active=test']

    useJUnitPlatform()
    finalizedBy jacocoTestReport
  }

  // JaCoCoのレポート出力の際に上述のクラスを除外する
  jacocoTestReport {
    reports {
      html.required = true
    }
  }
  
  // SpotBugs実施後、HTMLレポート出力も同時に行う
  spotbugsMain {
    reports {
      xml.enabled = false
      html {
        enabled true
        destination file("${buildDir}/reports/spotbugs/main.html")
      }
    }
  }
}