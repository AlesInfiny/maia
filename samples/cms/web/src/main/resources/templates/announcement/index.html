<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/layout}"
>
  <th:block layout:fragment="content">
    <div class="container mt-4">
      <div
        class="d-flex justify-content-between align-items-center mb-3 gap-3 flex-wrap"
      >
        <h2 class="mb-0" th:text="#{index.title}"></h2>
        <div
          class="d-flex align-items-center gap-3 flex-wrap w-100 w-md-auto"
          style="max-width: 100%"
        >
          <div
            class="text-secondary"
            th:text="${viewModel.totalCount} + '件中 ' + ${viewModel.startIndex} + '件 - ' + ${viewModel.endIndex} + '件を表示'"
            style="white-space: nowrap"
          ></div>
          <nav aria-label="ページネーション">
            <ul class="pagination mb-0">
              <li
                class="page-item"
                th:classappend="${!viewModel.hasPrevious} ? ' disabled'"
              >
                <a
                  class="page-link"
                  th:href="${viewModel.hasPrevious} ? @{/announcements(pageNumber=${viewModel.pageNumber-1}, pageSize=${viewModel.pageSize})} : null"
                  aria-label="前へ"
                  tabindex="-1"
                  >&lt;</a
                >
              </li>
              <li
                class="page-item"
                th:classappend="${!viewModel.hasNext} ? ' disabled'"
              >
                <a
                  class="page-link"
                  th:href="${viewModel.hasNext} ? @{/announcements(pageNumber=${viewModel.pageNumber+1}, pageSize=${viewModel.pageSize})} : null"
                  aria-label="次へ"
                  tabindex="-1"
                  >&gt;</a
                >
              </li>
            </ul>
          </nav>
          <a
            th:href="@{/announcements/create}"
            class="btn btn-primary ms-2"
            th:text="#{index.create_new_announcement}"
          ></a>
        </div>
      </div>
      <div
        th:if="${#lists.isEmpty(viewModel.announcementsWithContents)}"
        class="alert alert-info"
        th:text="#{index.no_announcements_message}"
      ></div>
      <table
        class="table table-hover"
        th:if="${!#lists.isEmpty(viewModel.announcementsWithContents)}"
      >
        <thead class="table-light">
          <tr>
            <th scope="col" th:text="#{index.table.title}"></th>
            <th scope="col" th:text="#{index.table.published_date}"></th>
            <th scope="col" th:text="#{index.table.category}"></th>
            <th scope="col" th:text="#{index.table.display_priority}"></th>
            <th scope="col" th:text="#{index.table.actions}"></th>
          </tr>
        </thead>
        <tbody>
          <tr
            th:each="announcementWithContents : ${viewModel.announcementsWithContents}"
          >
            <td th:text="${announcementWithContents.contents[0].title}"></td>
            <td
              th:text="${announcementWithContents.announcement.expireDate != null} ?
           ${announcementWithContents.announcement.postDate + ' - ' + announcementWithContents.announcement.expireDate} :
           ${announcementWithContents.announcement.postDate} + ' - '"
            ></td>
            <td
              th:text="${announcementWithContents.announcement.category}"
            ></td>
            <td
              th:text="${displayPriorityMap[announcementWithContents.announcement.displayPriority]}"
            ></td>
            <td>
              <a
                href="#"
                class="btn btn-sm btn-outline-primary me-1"
                th:text="#{index.edit}"
              ></a>
              <a
                href="#"
                class="btn btn-sm btn-outline-danger"
                th:text="#{index.delete}"
              ></a>
            </td>
          </tr>
        </tbody>
      </table>
      <nav aria-label="ページネーション" class="mt-3">
        <ul class="pagination justify-content-center mb-0">
          <!-- 1ページ目 -->
          <li
            class="page-item"
            th:classappend="${viewModel.pageNumber == 1} ? ' active disabled'"
          >
            <a
              class="page-link"
              th:href="${viewModel.pageNumber == 1} ? null : @{/announcements(pageNumber=1, pageSize=${viewModel.pageSize})}"
              >1</a
            >
          </li>

          <!-- 省略記号(前方) -->
          <li
            class="page-item disabled"
            th:if="${viewModel.pageNumber - 3 > 1}"
          >
            <span class="page-link">…</span>
          </li>

          <!-- 中間ページ -->
          <li
            class="page-item"
            th:each="i : ${#numbers.sequence(viewModel.pageNumber - 2, viewModel.pageNumber + 2)}"
            th:if="${i > 1 && i < viewModel.lastPageNumber}"
            th:classappend="${viewModel.pageNumber == i} ? ' active disabled'"
          >
            <a
              class="page-link"
              th:href="${viewModel.pageNumber == i} ? null : @{/announcements(pageNumber=${i}, pageSize=${viewModel.pageSize})}"
              th:text="${i}"
            ></a>
          </li>

          <!-- 省略記号(後方) -->
          <li
            class="page-item disabled"
            th:if="${viewModel.pageNumber + 3 < viewModel.lastPageNumber}"
          >
            <span class="page-link">…</span>
          </li>

          <!-- 最後のページ（2ページ以上ある場合のみ） -->
          <li
            class="page-item"
            th:if="${viewModel.lastPageNumber > 1}"
            th:classappend="${viewModel.pageNumber == viewModel.lastPageNumber} ? ' active disabled'"
          >
            <a
              class="page-link"
              th:href="${viewModel.pageNumber == viewModel.lastPageNumber} ? null : @{/announcements(pageNumber=${viewModel.lastPageNumber}, pageSize=${viewModel.pageSize})}"
              th:text="${viewModel.lastPageNumber}"
            ></a>
          </li>
        </ul>
      </nav>
    </div>
  </th:block>
</html>
