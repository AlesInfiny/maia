<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout}">
  <head>
    <title>お知らせメッセージ削除確認</title>
  </head>
  <body>
    <th:block layout:fragment="content">
      <!--/* ページタイトル */-->
      <h1 class="display-6 mb-4" th:text="#{announcement.deleteConfirm.pageTitle}"></h1>

      <div class="row">
        <!--/* 左側：基本情報部とお知らせメッセージ部 */-->
        <div class="col-8">
          <div class="card">
            <div class="card-body">
              <!-- 基本情報部 -->
              <p class="mb-4" th:text="#{announcement.deleteConfirm.deleteMessage}"></p>

              <div class="row mb-2">
                <div class="col-2 text-nowrap" th:text="|#{announcement.deleteConfirm.postAndExpireDateTime} :|"></div>
                <div class="col-10">
                  <span
                    th:text="${#temporals.format(viewModel.announcement.postDate, 'yyyy-MM-dd')} + ' ' + ${#temporals.format(viewModel.announcement.postTime, 'HH:mm')}"></span>
                  <span
                    th:if="${viewModel.announcement.expireDate != null}"
                    th:text="'-' + ${#temporals.format(viewModel.announcement.expireDate, 'yyyy-MM-dd')} + ' ' + ${#temporals.format(viewModel.announcement.expireTime, 'HH:mm')}"></span>
                </div>
              </div>

              <div class="row mb-2">
                <div class="col-2 text-nowrap" th:text="|#{announcement.deleteConfirm.category} :|"></div>
                <div class="col-10" th:text="${viewModel.announcement.category}"></div>
              </div>

              <div class="row mb-2">
                <div class="col-2 text-nowrap" th:text="|#{announcement.deleteConfirm.displayPriority} :|"></div>
                <div class="col-10" th:text="${displayPriorityLabelMap[viewModel.announcement.displayPriority]}"></div>
              </div>
            </div>

            <!--/* お知らせメッセージ部 */-->
            <div class="m-3">
              <!--/* お知らせメッセージが 1 件以上の場合 */-->
              <div th:each="content : ${viewModel.contents}" class="card mb-3">
                <div class="card-body position-relative">
                  <!-- 言語コードバッジを右上に配置 -->
                  <span
                    class="badge bg-secondary position-absolute top-0 end-0 m-3"
                    th:text="${languageCodeLabelMap[content.languageCode]}"></span>

                  <!-- タイトル -->
                  <div class="row mb-3">
                    <div class="col-2 text-nowrap" th:text="|#{announcement.deleteConfirm.title} :|"></div>
                    <div class="col-10" th:text="${content.title}"></div>
                  </div>

                  <!-- 表示メッセージ -->
                  <div class="row mb-3">
                    <div class="col-2 text-nowrap" th:text="|#{announcement.deleteConfirm.message} :|"></div>
                    <div class="col-10" th:text="${content.message}"></div>
                  </div>

                  <!-- リンク先URL（存在する場合のみ表示） -->
                  <div th:if="${content.linkUrl != null and !#strings.isEmpty(content.linkUrl)}" class="row">
                    <div class="col-2 text-nowrap" th:text="|#{announcement.deleteConfirm.linkUrl} :|"></div>
                    <div class="col-10">
                      <a th:href="${content.linkUrl}" th:text="${content.linkUrl}" target="_blank"></a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!--/* 右側：アクション部とお知らせメッセージ更新履歴部 */-->
        <div class="col-4">
          <div class="card">
            <div class="card-body d-flex flex-column gap-3">
              <h5 class="card-title" th:text="#{announcement.deleteConfirm.actions}"></h5>

              <!--/* 削除ボタン */-->
              <form th:action="@{/announcements/{id}/delete/confirm(id=${viewModel.announcement.id})}" method="post">
                <!--/* 全体エラーメッセージ */-->
                <!--/* 全体エラーメッセージを有効化する場合、上記のformタグにth:objectを追加します。
                本サンプルアプリケーションでは、エラーが発生した場合管理画面にリダイレクトする仕様であるため、全体エラーメッセージは表示しません。*/-->
                <!--/* <ul class="mb-0 text-danger" th:if="${#fields.hasGlobalErrors()}">
                  <li th:each="error : ${#fields.globalErrors()}" th:text="${error}"></li>
                </ul> */-->
                <button
                  type="submit"
                  class="btn btn-danger w-100"
                  th:text="#{announcement.deleteConfirm.deleteConfirmation}"></button>
              </form>
              <!--/* 編集リンク */-->
              <a
                th:href="@{/announcements/{id}/edit(id=${viewModel.announcement.id})}"
                class="btn btn-link"
                th:text="#{announcement.deleteConfirm.editAnnouncement}"></a>
              <!--/* 一覧に戻るリンク */-->
              <a
                th:href="@{/announcements}"
                class="btn btn-link"
                th:text="#{announcement.deleteConfirm.backToList}"></a>
            </div>
          </div>

          <!--/* お知らせメッセージ更新履歴部 */-->
          <div class="card mt-4">
            <div class="card-body">
              <h5 class="card-title" th:text="#{announcement.deleteConfirm.updateHistory}"></h5>

              <!--/* アコーディオン */-->
              <div class="accordion" id="historyAccordion" th:if="${!#lists.isEmpty(viewModel.histories)}">
                <div th:each="historyWithContents, iterStat : ${viewModel.histories}" class="accordion-item">
                  <h2 class="accordion-header" th:id="'heading' + ${iterStat.index}">
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      th:attr="data-bs-toggle='collapse', data-bs-target='#collapse' + ${iterStat.index}"
                      th:aria-expanded="false"
                      th:aria-controls="'collapse' + ${iterStat.index}">
                      <span
                        th:text="${#temporals.format(historyWithContents.history.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></span>
                      &nbsp;
                      <span th:text="${operationTypeLabelMap[historyWithContents.history.operationType]}"></span>
                      &nbsp;
                      <span th:text="${historyWithContents.history.changedBy}"></span>
                    </button>
                  </h2>
                  <div
                    th:id="'collapse' + ${iterStat.index}"
                    class="accordion-collapse collapse"
                    th:attr="aria-labelledby='heading' + ${iterStat.index}"
                    data-bs-parent="#historyAccordion">
                    <div class="accordion-body">
                      <!--/* 基本情報 */-->
                      <div class="mb-3">
                        <p>
                          <span
                            th:text="${#temporals.format(historyWithContents.history.postDateTime, 'yyyy-MM-dd HH:mm')}"></span>
                          <span
                            th:if="${historyWithContents.history.expireDateTime != null}"
                            th:text="' - ' + ${#temporals.format(historyWithContents.history.expireDateTime, 'yyyy-MM-dd HH:mm')}"></span>
                        </p>
                        <p>
                          <span
                            th:if="${historyWithContents.history.category != null and !#strings.isEmpty(historyWithContents.history.category)}"
                            th:text="${historyWithContents.history.category}"></span>
                          <span
                            th:if="${historyWithContents.history.category == null or #strings.isEmpty(historyWithContents.history.category)}"
                            th:text="#{announcement.deleteConfirm.categoryUnspecified}"></span>
                        </p>
                        <p
                          th:text="#{announcement.deleteConfirm.displayPriority} + ':' + ${displayPriorityLabelMap[historyWithContents.history.displayPriority]}"></p>
                      </div>

                      <!--/* コンテンツ履歴 */-->
                      <div th:each="contentHistory : ${historyWithContents.contentHistories}" class="card mb-2">
                        <div class="card-body">
                          <p th:text="${languageCodeLabelMap[contentHistory.languageCode]}"></p>
                          <p th:text="${contentHistory.title}"></p>
                          <p th:text="${contentHistory.message}"></p>
                          <p
                            th:if="${contentHistory.linkUrl != null and !#strings.isEmpty(contentHistory.linkUrl)}"
                            th:text="${contentHistory.linkUrl}"></p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </th:block>
  </body>
</html>
