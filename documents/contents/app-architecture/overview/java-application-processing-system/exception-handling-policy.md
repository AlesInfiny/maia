---
title: Java アプリケーションの 処理方式
description: アプリケーションの形態によらず、 Java アプリケーションで 考慮すべき関心事について、実装方針を説明します。
---

# 例外処理方針 {#exception-policy}

アプリケーション全体での例外処理方針を定めます。

## 例外の種類 {#exception-pattern}

AlesInfiny Maia OSS Edition （以降、 AlesInfiny Maia）では、アプリケーションで発生する例外を [業務例外](#business-exception) と [システム例外](#system-exception) の 2 つに分類します。
それぞれの例外の意味や処理方針を以下に示します。

### 業務例外 {#business-exception}

- 意味

    業務フロー上、想定されるエラーを表す例外です。

- 発生箇所

    アプリケーションコア層の業務ロジック内で、明示的にスローします。

- 処理方針

    プレゼンテーション層でキャッチし、業務フローに応じた処理を行います。

### システム例外 {#system-exception}

- 意味

    業務フロー上は想定されないシステムのエラーを表す例外です。
    実行ランタイムまでキャッチされずに到達した例外は、すべてシステム例外として扱います。

- 発生箇所

    Java の実行ランタイム内からスローされます。
    またアプリケーションとして想定していない状態となったとき、業務ロジック内から明示的にスローすることがあります。

- 処理方針

    集約例外ハンドラー内でキャッチして、システムエラーの処理フローを実行します。

## 業務例外とシステム例外の使い分け {#usage-of-business-and-system-exceptions}

原則として、システム例外は業務ロジック内からスローしないようにします。
何らかのエラー状態を業務ロジックとして検出するのであれば、そのエラーを回復するための手段を業務フローとして設計し、業務例外として処理します。

ただし利用するライブラリによっては、本来システムエラーとして扱うべきエラーを、検査例外としてスローすることがあります。
このような場合、すべての検査例外に対応する業務ロジックを設計したり、ユーザーの再操作によってエラー状態を回復したりすることは困難です。
AlesInfiny Maia では、業務フロー内で検査例外が発生した際の処理として、システム例外に付け替えてリスローすることを許可します。

## 例外発生時のエラーレスポンス {#error-response}

業務例外やシステム例外の発生時、クライアントサイドにエラーレスポンスを返却します。
その際、エラーレスポンスには [ProblemDetails :material-open-in-new:](https://www.rfc-editor.org/rfc/rfc9457.html){ target=_blank } に基づいたレスポンスボディーを含めます。

ProblemDetails は、 HTTP API のエラーレスポンスを標準化するための構造体であり、以下のプロパティで定義されています。

| プロパティ名 |  必須 / 省略可能   |                                                 内容                                                  |
| ------------ | ------------------ | ----------------------------------------------------------------------------------------------------- |
| detail       | 開発環境でのみ必須 | 問題の詳細な説明。エラーの具体的な内容を説明します。                                                  |
| extensions   | 省略可能           | 拡張メンバー。 ProblemDetails のプロパティを拡張する場合に利用します。                                |
| instance     | 必須               | 問題の発生場所を示す URI 。特定のエラーインスタンスを識別するために使用します。                       |
| status       | 必須               | HTTP エラーのステータスコード。                                                                       |
| title        | 必須               | 問題の簡潔な説明。人間が読める形式で提供されます。                                                    |
| type         | 必須               | 問題の種類を識別する URI 参照。逆参照されると、エラーの詳細ドキュメントを提供することが推奨されます。 |

また、 AlesInfiny Maia OSS Edition では、上記のプロパティに加えて拡張メンバーとして以下を定義しています。

- exceptionId

    例外 ID 。メッセージファイルからエラーメッセージを取得するためのメッセージコードとして利用します。

- exceptionValues

    例外値。例外 ID から取得したエラーメッセージ内のパラメーターに代入する値として利用します。

これらの拡張メンバーを利用するためのクライアントサイドのメッセージ管理方針については、[こちら](../../client-side-rendering/global-function/message-management-policy.md) を確認してください。
