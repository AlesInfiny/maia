---
title: CSR 編 - Web API
description: バックエンドアプリケーションのアーキテクチャについて、層ごとに詳細を説明します。
---

# バックエンドアプリケーションのアーキテクチャ {#top}

## 全体構成 {#application-architecture-overview}

AlesInfiny Maia OSS Edition （以降、 AlesInfiny Maia）のバックエンドアプリケーションアーキテクチャは、クリーンアーキテクチャに基づいています。
アーキテクチャの全体概要は以下の通りです。

![アーキテクチャ概要図](../../../images/app-architecture/client-side-rendering/csr-architecture-light.png#only-light){ loading=lazy }
![アーキテクチャ概要図](../../../images/app-architecture/client-side-rendering/csr-architecture-dark.png#only-dark){ loading=lazy }

## 層の構造詳細 {#layer-structure}

クライアントサイドレンダリング方式の Web アプリケーションにおける、各層とそれを構成するコンポーネントの役割について、それぞれ説明します。

### アプリケーションコア層 {#application-core}

アプリケーションコア層は、ドメインモデルの定義と業務処理を実装する業務中心の層です。

- ドメインモデル

    ドメインモデルは、業務で扱うドメインをクラスとして表現するエンティティと値オブジェクトで構成するコンポーネントです。
    共にモデルのデータ構造と振る舞いを持つことは変わりませんが、エンティティはプロパティが可変である一方、値オブジェクトのプロパティは不変です。

- ドメインサービス

    ドメインサービスは、エンティティや値オブジェクトに含めることが適当ではないドメイン固有の処理を実装するコンポーネントです。
    ドメイン単位でクラスにまとめ、ドメインに対する処理毎にメソッドとして実装します。
    必要に応じてリポジトリを利用して、データベースなどの外部リソースにアクセスします。
    アプリケーションコア層のリポジトリインターフェースを利用し、インフラストラクチャ層のリポジトリ実装に依存しないよう注意してください。

- アプリケーションサービス

    アプリケーションサービスは、システムに必要な機能を実装するクラスです。
    1 つの Web API の業務処理がアプリケーションサービスの 1 メソッドに対応します。
    エンティティや値オブジェクト、リポジトリ ( インターフェース ) を組み合わせて、必要な機能を実現します。
    必要に応じてドメインサービスも利用します。

- リポジトリ ( インターフェース )
  
    アプリケーションコア層のリポジトリはインターフェースであり、インフラストラクチャ層のリポジトリで実装されます。
    依存関係逆転の法則に従い、アプリケーションコア層の実装がインフラストラクチャ層に依存しないようするためのインターフェースです。

詳細は以下をご覧ください。

- [アプリケーションコア層の実装方針](application-core.md)

### プレゼンテーション層 {#presentation}

プレゼンテーション層は、主にシステムの利用者とのやり取りを担う層です。
画面を構成するフロントエンドアプリケーションと、バックエンドアプリケーションのインターフェースとなる Web API を配置します。

- コントローラー
  
    コントローラーは Spring MVC のコントローラーに対応し、各 Web API の定義と実装を担います。
    業務処理であるアプリケーションサービスを呼び出し、その結果からレスポンスデータを生成します。

- API モデル

    Web API のリクエスト／レスポンスの形式を定義するクラスです。
    コントローラーが受け取る引数やレスポンスの型を Java のクラスで表現します。

- ビュー

    ビューは Vue.js の JavaScript アプリケーションとして実装します。

詳細は以下をご覧ください。

- [プレゼンテーション層の実装方針](presentation.md)

### インフラストラクチャ層 {#infrastructure}

インフラストラクチャ層は、データベースを中心とする外部リソースにアクセスする処理を実現する層です。

- リポジトリ
  
    インフラストラクチャ層のリポジトリは、アプリケーションコア層のリポジトリインターフェースの実装クラスで、具体的なデータベースアクセス処理を実装します。
    データベースとはテーブルエンティティの型を利用してデータをやり取りします。
    それに対してリポジトリインターフェースはドメインモデルの型を用いて構成されています。
    インフラストラクチャ層のリポジトリは、これらの型同士の変換処理を行う役割も持ちます。

- テーブルエンティティ

    テーブルエンティティはデータベースのテーブルに対応するデータ構造を表現するクラスです。
    1 つのテーブルエンティティオブジェクトがテーブルの 1 レコードに対応します。

詳細は以下をご覧ください。

- [インフラストラクチャ層の実装方針](infrastructure.md)

### プロジェクト構成と各層とのマッピング {#project-layer-mapping}

AlesInfiny Maia では Java のプロジェクト構成として、複数のサブプロジェクトに分割し、それらをルートプロジェクトでまとめて管理するマルチプロジェクト構成を採用します。
サブプロジェクトの分割については、これまでに説明したアプリケーションコア層、プレゼンテーション層、インフラストラクチャ層の各層を 1 つのサブプロジェクトとして対応させることを推奨します。

どの層からも利用されるようなシステム共通機能については、依存関係からアプリケーションコア層に含める考えもありますが、こちらも独立したサブプロジェクトとすることを推奨します。
業務機能とシステム共通機能を分割することで、プロジェクトの役割や依存関係が明確になり、保守性が高まると考えられます。

各サブプロジェクトの内部構成については、以下のような構成を推奨します。

![フォルダ構成図](../../../images/app-architecture/client-side-rendering/csr-project-structure-light.png#only-light){ loading=lazy }
![フォルダ構成図](../../../images/app-architecture/client-side-rendering/csr-project-structure-dark.png#only-dark){ loading=lazy }

プロジェクト構造全体は、 Spring Initializr で生成した Gradle プロジェクトの構造と変わりはありません。
パッケージの構成としては、システムで 1 つのフォルダー ( aa.bb.cc ) をベースに、各層に対応するパッケージ ( application-core など ) を作成します。
アプリケーションコア層については、ドメインの単位でパッケージを作成し、それ以外の層については、構成するコンポーネント単位でパッケージを作成することを想定しています。
以降の階層については、管理や機能面を考慮し、必要に応じてサブパッケージを作成してください。
