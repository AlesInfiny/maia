# 全体処理方式

アプリケーション全体で考慮すべき各種関心事について、その実装方針を説明します。

## 例外処理

Maia OSS版では、アプリケーションで発生する例外を業務例外とシステム例外の2つに分類します。それぞれの例外が表す内容や処理方針は下表のとおりです。

|  |  業務例外  |  システム例外  |
| ---- | ---- | ---- |
| *意味* | 業務フロー上、想定されるエラーを表す例外 | 業務フロー上は想定されないシステムのエラーを表す例外 |
| *クラス名(例)* | LogicException | SystemException |
| *発生箇所* | アプリケーションコア層の業務ロジック内 | 任意の場所 |
| *処理方針* | プレゼンテーション層でキャッチし、業務フローに応じた処理を行う。キャッチされなかった場合は、下記のシステム例外として集約例外ハンドラに処理される。 | 集約例外ハンドラ内でキャッチして、業務フローに応じた処理を行う。 |

＜サーバーサイド全体での例外処理の方針を表す図。＞

なお、集約例外ハンドラについての詳細は、[サーバーサイド機能解説のプレゼンテーション層](server-side-function/presentation.md)を参照してください。

### 業務例外とシステム例外の使い分け

原則として、システム例外は極力業務ロジック内からスローすべきではなく、可能な限り例外発生時の対応を業務フローとして設計した上で業務例外として処理します。
とはいえ、利用ライブラリが不要な検査例外をスローしてくることもあり、現実的に全てのフローを設計したりユーザー再操作で回復可能にするのは困難です。そのため、Maia OSS版では業務フロー内で検査例外が発生した際の処理としてシステム例外をリスローすることも許可しています。

## ログ出力

ログ出力には、Log4jを利用します。出力先やフォーマットの設定は、Log4jの公式ドキュメントを参照してください。

## メッセージ管理

画面やログに表示するメッセージ文字列は、表記ブレなどを防ぐためにプロパティファイルで管理します。

<定数クラスとプロパティファイルを利用したメッセージ管理の方式を表す図>

<!-- ### トランザクション管理 -->

## 入力値検査

入力値検査は単項目チェックと項目間チェック、複合チェックに分類し、それぞれ以下の方針で処理します。

- 単項目チェック
    - 説明：単一のフィールドで完結するチェック
    - 例：入力必須チェック、桁チェック、型チェック
    - 検証箇所：プレゼンテーション層
    - 実装方法：Bean Validation
- 項目間チェック
    - 説明：複数のフィールドを比較するチェック。
    - 例：パスワードと確認用パスワードの一致チェック、タスク終了日が開始日より後であることのチェック
    - 検証箇所：プレゼンテーション層
    - 実装方法：プレゼンテーション層の業務ロジック内で実装。繰り返し使用するものはBean Validationを独自拡張して汎用化。
- 複合チェック
    - 説明：（DB内のデータなど）システムの状態によって入力値が妥当かどうかが変わるチェック
    - 例：新規登録用のユーザーIDが既に登録されていないかのチェック、注文数が在庫数以内であるかのチェック
    - 検証箇所：アプリケーションコア層
    - 実現方法：アプリケーションコア層の業務ロジック内で実装

<!-- ### セキュリティ対策 -->
