# 全体機能解説

アプリケーション全体の関心事となる各種機能の実装方針を説明します。

## 例外処理

- v0.1では、サーバーサイドでの例外処理にのみ注目して記載する
- 例外分類と対応クラス、処理方針は以下の通り。
    - 業務例外
        - 意味：業務フロー上、想定されるエラーを表す例外
        - クラス(例)：LogicException
        - 発生箇所：アプリケーションコア層の業務ロジック内
        - 処理方針：プレゼンテーション層でキャッチして、業務フローに応じた処理を行う。キャッチされなかった場合は、下記のシステム例外として集約例外ハンドラに処理される。
    - システム例外
        - 意味：業務フロー上は想定されないシステムのエラーを表す例外
        - クラス：SystemException
        - 発生箇所：任意のロジック
        - 処理方針：集約例外ハンドラ内でキャッチして、業務フローに応じた処理を行う。
- サーバーサイド全体での例外処理の方針を表す図。
- 集約例外ハンドラについての詳細は、[サーバーサイド機能解説のプレゼンテーション層](server-side-function/presentation.md)を参照のこと。

### 業務例外とシステム例外の使い分け

- 原則として、システム例外は極力業務ロジック内からスローすべきではなく、可能な限り例外発生時の対応を業務フローとして設計した上で業務例外として処理すべき。
- ユーザー体験の観点からも共通システムエラー画面に飛ばすのは避けたい。
- とはいえ、利用ライブラリが不要な検査例外をスローしてくることもあり、現実的に全てのフローを設計したりユーザー再操作で回復可能にするのは難しい。そのため、業務フロー内で検査例外が発生した際の処理としてシステム例外をリスローすることも許可する。（この時、元の例外を原因例外として設定すること）

## ログ出力

- v0.1では、サーバーサイドでの例外処理にのみ注目して記載する。
- ログ出力には、Log4jを利用する。出力先やフォーマットの設定は、Log4jの公式ドキュメントを参照のこと。
- ログレベルと用途は以下の通り。
    - DEBUG
    - INFO
    - WARN
    - ERROR
    - FATAL

## メッセージ管理

- v0.1では、サーバーサイドでの例外処理にのみ注目して記載する
- 定数クラスとプロパティファイルを利用したメッセージ管理の方式を説明する。

<!-- ### トランザクション管理 -->

## 入力値検査

- v0.1では、サーバーサイドでの例外処理にのみ注目して記載する
- 入力値検査は単項目チェックと項目間チェック、複合チェックに分類される
    - 単項目チェック
        - 説明：単一のフィールドで完結するチェック
        - 例：入力必須チェック、桁チェック、型チェック
        - 検証箇所：プレゼンテーション層
        - 実装方法：Bean Validation
    - 項目間チェック
        - 説明：複数のフィールドを比較するチェック。
        - 例：パスワードと確認用パスワードの一致チェック、タスク終了日が開始日より後であることのチェック
        - 検証箇所：プレゼンテーション層
        - 実装方法：プレゼンテーション層の業務ロジック内で実装。繰り返し使用するものはBean Validationを独自拡張して汎用化。
    - 複合チェック
        - 説明：（DB内のデータなど）システムの状態によって入力値が妥当かどうかが変わるチェック
        - 例：新規登録用のユーザーIDが既に登録されていないかのチェック、注文数が在庫数以内であるかのチェック
        - 検証箇所：アプリケーションコア層
        - 実現方法：アプリケーションコア層の業務ロジック内で実装

<!-- ### セキュリティ対策 -->
